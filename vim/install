#!/usr/bin/env bash

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Source config files from parent directory
[ -f "$SCRIPT_DIR/../os" ] && source "$SCRIPT_DIR/../os"
[ -f "$SCRIPT_DIR/../func" ] && source "$SCRIPT_DIR/../func"
opts "$@"

echo "install nvim-config chadv3: $NVCHAD_V3"
if [ $NVCHAD_V3 == true ]; then
	cd "$SCRIPT_DIR/nvchad/v3" && ./install "$@" && cd -
else
	cd "$SCRIPT_DIR/lua-nvim" && ./install "$@" && cd -
fi
echo "done: install nvim-config"

echo "install vimrc, from $PWD"

# Copy .vim directory only if it exists
if [ -d "$SCRIPT_DIR/vim/.vim" ]; then
	cp -r "$SCRIPT_DIR/vim/.vim" ~/
else
	echo "Warning: $SCRIPT_DIR/vim/.vim directory not found, skipping..."
fi

case "$OS" in
"MAC")
	echo "found as MacOS, cp .vim rc files.."
	[ -f "$SCRIPT_DIR/vim/.vimrc" ] && cp "$SCRIPT_DIR/vim/.vimrc" ~
	;;
"UBUNTU")
	echo "found as ubuntu. cp ubuntu rc files.."
	if [ -f "$SCRIPT_DIR/vim/.vimrc-ubuntu" ]; then
		cp "$SCRIPT_DIR/vim/.vimrc-ubuntu" ~/.vimrc
	fi
	;;
**)
	echo "unknown os"
	;;
esac

if [ $PACKAGE = true ]; then
	PKGM=$(getpkgm)
	echo "pkgm $PKGM"
	if [ "$OS" == "UBUNTU" ]; then
		install exuberant-ctags "$PKGM"
	elif [ "$OS" == "MAC" ]; then
		install ctags "$PKGM"
	fi
fi

echo "done:install vimrc"
