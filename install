#!/usr/bin/env bash

source ./os
source ./func

echo "the os is $OS"

main() {
	opts "$@"
	if [ $PACKAGE = true ]; then
		PKGM=$(getpkgm)
		echo "pkgm $PKGM"
		install fzf "$PKGM"
		install wget "$PKGM"
		install grc "$PKGM"
		install yq "$PKGM"
		install jq "$PKGM"
		install gh "$PKGM"
	fi

	# zsh
	cp .zshrc ~/.zshrc
	[ -f .env.workspace ] && cp .env.workspace ~/.env.workspace

	cd ./colour-mysql-console && ./install "$@" && cd ..

	cp -r kitty/* ~/.config/kitty/
	[ -f ./vim/install ] && cd ./vim && ./install "$@" && cd ..
	[ -f ./scripts/install ] && cd ./scripts/ && ./install "$@" && cd ..
}

getpkgm() {
	case $OS in
	'MAC') echo 'brew' ;;
	'UBUNTU') echo 'apt' ;;
	*) 'unknown os' ;;
	esac
}

install() {
	case $2 in
	'apt')
		INSTALLED=$(apt list "$1")
		if [ -z "$INSTALLED" ]; then
			apt install "$1"
		fi
		;;
	'brew')
		INSTALLED=$(brew list "$1")
		if [ -z "$INSTALLED" ]; then
			brew install "$1"
		fi
		;;
	'pnpm')
		INSTALLED=$(pnpm list -g "$1")
		if [ -z "$INSTALLED" ]; then
			pnpm i -g "$1"
		fi
		;;
	*)
		echo "unknown command: $2"
		;;
	esac
}

main "$@"
